<a name="top"></a>
<h1><%= @bp_pic_group.bp_pic_group_name %> 詳細</h1>
<div style="color:gray"><%= @bp_pic_group.memo %></div>
<% unless @called_by_delivery_mail_create %>
  <div style="text-align:right">
  <%= back_to_link 'グループ名とメモの編集', {:action => :edit, :id => @bp_pic_group.id} %> |
  <%= link_to 'グループを削除', {:action => :destroy, :id => @bp_pic_group.id, :authenticity_token => form_authenticity_token}, method: :delete, data: { confirm: '削除します。よろしいですか?' } %>
  </div>
<% end %>
<hr />
<div>
  <%= form_tag(url_for(:controller => :bp_pic_group_details, :action => :create), :method => :post) do %>
    <table class="show_table">
        <tr>
        <th><label for="business_partner_name">取引先</label></th><td><%= text_field_tag 'business_partner_name', "", :readOnly => true, :style => "background-color: silver;", :size => 30 %>
            <input type=button value='...' onClick="disp_wide('<%=url_for :controller => 'business_partner', :action => 'list', :popup =>1, :flg => 'upper' %>');return false;" />
            <input type=button value='クリア' onClick="clearBp();return false;" />
        </tr>
        <tr>
        <th><label for="bp_pic_name">取引先担当</label></th><td><%= text_field_tag 'bp_pic_name', "", :readOnly => true, :style => "background-color: silver;", :size => 30 %>
            <input type=button value='...' onClick="openBpPicList('<%=url_for :controller => 'bp_pic', :action => 'list', :popup =>1 %>');return false;" />
            <input type=button value='クリア' onClick="clearBpPic();return false;" />
            <%= hidden_field 'bp_pic_group_detail', 'bp_pic_id' %></td>
        </tr>
    </table>
    <%= hidden_field_tag 'bp_pic_group_detail[owner_id]', @bp_pic_group.owner_id %>
    <%= hidden_field_tag 'bp_pic_group_detail[bp_pic_group_id]', @bp_pic_group.id %>
    <%= back_to_field_tag %>
    <%= submit_tag "取引先担当を追加" %>
  <% end %>
  <input type="hidden" id="business_partner_id" />
</div>
<div>
  <%= form_tag(url_for(:controller => :delivery_mails, :action => :add_details), :method => :post) do %>
    <%= back_to_field_tag %>
    <table class="show_table">
      <tr>
        <% if @called_by_delivery_mail_create %>
          <th></th>
        <% end %>
        <th><%= getLongName('business_partners', 'business_partner_name') %></th>
        <th><%= getLongName('bp_pics', 'bp_pic_name') %></th>
        <% unless @called_by_delivery_mail_create %>
          <th>削除</th>
        <% end %>
      </tr>
      <% @bp_pic_group.bp_pic_group_details.each do |detail| %>
        <% if (not detail.bp_pic.nil?) and (not detail.bp_pic.business_partner.nil?) %>
          <tr>
            <% if @called_by_delivery_mail_create %>
              <td><%= check_box_tag 'bp_pic_ids[]', detail.bp_pic_id, true %></td>
            <% end %>
            <td><%= back_to_link detail.bp_pic.business_partner.business_partner_name, :controller => :business_partner, :action => :show, :id => detail.bp_pic.business_partner_id %></td>
            <td><%= back_to_link detail.bp_pic.bp_pic_name, :controller => :bp_pic, :action => :show, :id => detail.bp_pic_id %></td>
            <% unless @called_by_delivery_mail_create %>
              <td><%= back_to_link '削除', {:controller => :bp_pic_group_details, :action => :destroy, :id => detail.id, :authenticity_token => form_authenticity_token}, :method => :delete %></td>
            <% end %>
          </tr>
        <% end %>
      <% end %>
    </table>
    <% if @called_by_delivery_mail_create %>
      <%= hidden_field_tag 'delivery_mail_id', @delivery_mail_id %>
      <%= submit_tag "メール作成" %>
    <% end %>
  <% end %>
<div>
<div><a href="#top">ページトップ</a></div>
<%= link_or_back '戻る', bp_pic_groups_path %>

<script type="text/javascript">
<!--

var form_id_list = {
  business_partner_id: "business_partner_id",
  business_partner_name: "business_partner_name",
  bp_pic_id: "bp_pic_group_detail_bp_pic_id",
  bp_pic_name: "bp_pic_name"
}

document.busines_pertner = new BuisinessPartnerForm( form_id_list );
document.bp_pic = new BpPicForm( form_id_list );

//-->
</script>